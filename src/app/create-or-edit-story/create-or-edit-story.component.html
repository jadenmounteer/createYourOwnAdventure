<h1 *ngIf="!storyID">Create Story</h1>
<h1 *ngIf="storyID">Edit Story</h1>

<form (ngSubmit)="onSubmit(f)" #f="ngForm">
  <fieldset>
    <div class="form-group">
      <label for="title" class="form-label mt-4">Title</label>
      <input
        name="title"
        type="text"
        class="form-control"
        id="title"
        ngModel="{{ storyToEdit?.title }}"
        required
      />
    </div>
  </fieldset>
  <div *ngFor="let page of this.storyToEdit?.pages">
    <hr />
    <legend>{{ 'Page: ' + page.pageNumber }}</legend>
    <fieldset>
      <div class="form-group">
        <label for="pageText" class="form-label mt-4">Page Text</label>
        <textarea
          class="form-control"
          name="pageText"
          rows="3"
          value="{{ page.pageText }}"
          required
        ></textarea>
      </div>

      <label for="pageText" class="form-label mt-4"
        >When reader finishes the page...</label
      >
      <div class="form-check">
        <input
          class="form-check-input"
          type="radio"
          name="{{ page.pageNumber }}"
          id="optionsRadios1"
          value="1"
          required
          ngModel="{{ page.whenReaderFinishesPage }}"
        />
        <label class="form-check-label" for="{{ page.pageNumber }}">
          Continue to next page
        </label>
      </div>
      <div class="form-check">
        <input
          class="form-check-input"
          type="radio"
          name="{{ page.pageNumber }}"
          id="optionsRadios2"
          value="2"
          required
          ngModel="{{ page.whenReaderFinishesPage }}"
        />
        <label class="form-check-label" for="{{ page.pageNumber }}">
          Make a choice
        </label>
      </div>
      <div class="form-check">
        <input
          class="form-check-input"
          type="radio"
          name="{{ page.pageNumber }}"
          id="{{ page.pageNumber }}3"
          value="3"
          ngModel="{{ page.whenReaderFinishesPage }}"
          required
        />
        <label class="form-check-label" for="{{ page.pageNumber }}">
          Trigger an ending
        </label>
      </div>

      <!-- Choices -->
      <div [hidden]="page.whenReaderFinishesPage !== 2">
        <div *ngFor="let choice of page.choices">
          <label class="form-label mt-4">Choice {{ choice.number }}</label>
          <textarea
            class="form-control choice-input"
            name="choice{{ choice.number }}"
            rows="3"
            value="{{ choice.text }}"
            required
          ></textarea>
        </div>
      </div>
    </fieldset>
  </div>

  <div class="submit-buttons">
    <button type="submit" class="btn btn-success" *ngIf="f.valid">
      {{ editMode ? 'Update' : 'Publish' }}
    </button>

    <button
      type="button"
      class="btn btn-success disabled"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      data-toggle="tooltip"
      data-placement="top"
      title="Your story must have at least one ending before you publish."
      *ngIf="!f.valid"
    >
      {{ editMode ? 'Update' : 'Publish' }}
    </button>

    <button
      type="submit"
      class="btn btn-primary"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      data-toggle="tooltip"
      data-placement="top"
      title="Save your draft and finish it later."
    >
      Save Draft
    </button>
  </div>
</form>
